<%- include('../common/header') %>
<%- include('../common/sidebar') %>

<!-- BEGIN: Content-->
<div class="app-content content ">
<div class="content-wrapper container-xxl p-0">
  <div class="content-body">
    <section id="multiple-column-form">
      <div class="card">
        <div class="card-header">
          <h4 class="card-title"> Edit log</h4>
        </div>
        <div class="card-body">
          <form class="form form-vertical" action="/updatecms" id="validator" method="POST" enctype="multipart/form-data">

          <!-- <form action="/updatecms" method="post"> -->
          <div class="form-group row mb-1">
            <label class="col-form-label text-md-left col-10 col-md-1 col-lg-1">Title</label>
            <div class="col-sm-12 col-md-12">
              <input type="text" name="title" value="<%- changelogData?.title %>" class="form-control" required>
            </div>
          </div>
          <div class="form-group row mb-1">
            <label class="col-form-label text-md-left col-10 col-md-1 col-lg-1">Version</label>
            <div class="col-sm-12 col-md-12">
              <input type="text" name="version" value="<%- changelogData?.version %>" class="form-control">
              <input type="hidden" name="id" value="<%- changelogData?.id %>">
            </div>
          </div>
          <div class="form-group row mb-1">
            <label class="col-form-label col-12 col-md-3 col-lg-3">Description</label>
            <div class="col-sm-12 col-md-12">
              <% if (session.role == 3) { %>
                <% if (session.changelog_permission == 3) { %>
                  <textarea class="content form-control" id="editor" name="description"><%- changelogData?.description %></textarea>
                  <input type="hidden" name="id" value="<%- changelogData?.id %>">
                  <br>
                  <br>
                  <button type="submit" class="btn btn-primary">Submit <i class="icon-arrow-right14 position-right"></i></button>
                <% } else if (session.changelog_permission == 2) { %>
                  <textarea class="content form-control" id="editor" name="description" disabled><%- changelogData?.description %></textarea>
                  <input type="hidden" name="id" value="<%- changelogData?.id %>">
                  <br>
                  <!-- <button type="submit" class="btn btn-primary" disabled>Submit <i class="icon-arrow-right14 position-right"></i></button> -->
                <% } else { %>
                  <textarea class="content form-control" id="editor" name="description"><%- changelogData?.description %></textarea>
                  <input type="hidden" name="id" value="<%- changelogData?.id %>">
                  <br>
                  <br>
                  <button type="submit" class="btn btn-primary">Submit <i class="icon-arrow-right14 position-right"></i></button>
                <% } %>
              <% } else if (session.role == 0) { %>
                <textarea class="content form-control" id="editor" name="description"><%- changelogData?.description %></textarea>
                <input type="hidden" name="id" value="<%- changelogData?.id %>">
                <br>
                <br>
                <button type="submit" class="btn btn-primary">Submit <i class="icon-arrow-right14 position-right"></i></button>
              <% } else { %>
                <textarea class="content form-control" id="editor" name="description" disabled><%- changelogData?.description %></textarea>
                <input type="hidden" name="id" value="<%- changelogData?.id %>">
                <br>
                <!-- <button type="submit" class="btn btn-primary" disabled>Submit <i class="icon-arrow-right14 position-right"></i></button> -->
              <% } %>
              
            </div>
          </div>
        </form>
        </div>
      </div>
    </section>
  </div>
</div>
</div>
<div class="sidenav-overlay"></div>
<div class="drag-target"></div>

<%- include('../common/footer') %>
<script src="https://cdn.ckeditor.com/ckeditor5/35.2.0/classic/ckeditor.js"></script>

<script>
  ClassicEditor
      .create(document.querySelector('#editor'))
      .then(editor => {
          console.log(editor);
      })
      .catch(error => {
          console.error(error);
      });
</script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>

          
<script>
  $(document).ready(function() {
    jQuery.validator.addMethod("noSpace", function(value, element) {
      return value == '' || value.trim().length != 0;
    }, "No space allowed");

   
    jQuery.validator.addMethod("validImage", function(value, element, param) {
      return this.optional(element) || /\.(jpe?g|gif|png)$/i.test(value);
    }, 'Only valid image files (JPEG, GIF, PNG) are allowed.');
  
    $('#validator').validate({
      rules: {
        title: {
          required: true,
          noSpace: true,
          maxlength: 30,
          noSpecialChars: true
        },
        version:{
          required: true,
          noSpace: true,
          // maxlength: 50
        },
        description: {
          required: true,
          noSpace: true,
          // maxlength: 50
        },
   
      },
      errorElement: "div",
      errorClass: "jqval-error",
      errorPlacement: function(error, element) {
        error.insertAfter(element);
        error.slideDown(400);
        error.animate({
          opacity: 1
        }, {
          queue: false,
          duration: 700
        });
      },
      submitHandler: function(form) {
        var error = $(".assign_error_div").text();
        if (!error) {
          form.submit();
        }
      }
    });
  });
</script>