<%- include('../common/header') %>
<%- include('../common/sidebar') %>


<!-- BEGIN: Content-->
<div class="app-content content ">

  <div class="content-wrapper container-xxl p-0">
    <div class="content-body">
      <section id="multiple-column-form">
        <form action="/push-notification" method="post" id="add_validator">
          <div class="row">
            <div class="col-md-10 mx-auto">
              <div class="form-group row my-3">
                <label for="users" class="col-sm-12 col-form-label">Users</label>
                <div class="col-10">
                  <select id="users" class="form-control js-example-basic-multiple" required name="users" multiple="multiple">
                    <% for(let i in getUser){ %>
                    <option value="<%= getUser[i]._id %>"><%= getUser[i].name %> <%= getUser[i].sur_name %></option>
                    <%  } %>
                  </select>
                </div>
                <div class="custom-control custom-checkbox col-2 mt-1">
                  <input type="checkbox" class="custom-control-input" id="allUser">
                  <label class="custom-control-label" for="allUser">All</label>
                </div>
              </div>
              <div class="form-group row">
                <label for="message" class="col-sm-12 col-form-label">Message</label>
                <div class="col-sm-12">
                  <textarea class="form-control" name="message" id="message" rows="4"></textarea>
                </div>
              </div>
              <div class="form-group row  pt-2  ">
                <div class="col-sm-9 ms-auto">

                  <button class="btn btn-primary" type="submit">Send</button>
                  <div class="col-sm-9">

                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </section>
    </div>
  </div>
</div>
<div class="sidenav-overlay"></div>
<div class="drag-target"></div>
<%- include('../common/footer') %>


<script src="../../../javascripts/sendToken.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js" 
integrity="sha512-37T7leoNS06R80c8Ulq7cdCDU5MNQBwlYoy1TX/WUsLFC2eYNqtKlV0QjH7r8JpG/S0GUMZwebnVFLPd6SU5yg==" 
crossorigin="anonymous" referrerpolicy="no-referrer">
</script>

<script>
  $(document).ready(function() {
    $('.js-example-basic-multiple').select2({
      placeholder: 'Select an option'
    });

    $("#allUser").click(function() {
      if ($("#allUser").is(':checked')) {
        $("#users > option").prop("selected", true);
        $("#users").trigger("change");
      } else {
        $("#users > option").prop("selected", false);
        var selected = $("#user_id").val();
        if (!selected || selected.length == 0) {
          $("#users").val([]).trigger("change");
        } else {
          $("#users").trigger("change");
        }
      }
    });

  });
</script>

<script>
  $(document).ready(function() {
    jQuery.validator.addMethod("noSpace", function(value, element) {
      return value == '' || value.trim().length != 0;
    }, "No space allowed");

    jQuery.validator.addMethod("validImage", function(value, element, param) {
      return this.optional(element) || /\.(jpe?g|gif|png)$/i.test(value);
    }, 'Only valid image files (JPEG, GIF, PNG) are allowed.');
  

    $('#add_validator').validate({
      rules: {
        message:{
          required: true,
          noSpace: true,
          maxlength: 100
        },
      },
      errorElement: "div",
      errorClass: "jqval-error",
      errorPlacement: function(error, element) {
        error.insertAfter(element);
        error.slideDown(400);
        error.animate({
          opacity: 1
        }, {
          queue: false,
          duration: 700
        });
      },
      submitHandler: function(form) {
        var error = $(".assign_error_div").text();
        if (!error) {
          form.submit();
        }
      }
    });
  });
</script>