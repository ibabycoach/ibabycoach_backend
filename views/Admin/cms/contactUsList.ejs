<%- include('../common/header') %>
  <%- include('../common/sidebar') %>

    <!-- BEGIN: Content-->
    <div class="app-content content ">
      <div class="content-overlay"></div>
      <div class="header-navbar-shadow"></div>
      <div class="content-wrapper container-xxl p-0">
        <div class="content-body">
          <section id="responsive-datatable">
            <div class="row">
              <div class="card">
                <div class="card-header border-bottom">
                  <h4 class="card-title">Contact us</h4>
                  <!-- <div class="section-header-breadcrumb-right">
                                <a href="/addUser" class="btn btn-primary float-right" title="Edit Profile"> Add User </a>    
                            </div> -->
                </div>
                <br>
                <div class="card-DataTable table-responsive">
                  <% if (session.role == '3') {%>
                  <table class="table table-hover-animation">
                    <thead>
                      <tr>
                        <th>S NO.</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Message</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <%contactUsData.forEach(function(data,i) {%>
                        <tr>
                          <td>
                            <%=1+i%>
                          </td>
                          <td>
                            <%=data.name%>
                          </td>
                          <td>
                            <%=data.email%>
                          </td>
                          <td>
                            <%=data.phone%>
                          </td>
                            <td>
                              <%= data.message.length > 20 ? data.message.substring(0, 20) + "..." : data.message %>
                            </td>
                          <td>
                            <a href="/viewContactUs/<%=data._id%>" class="btn btn-sm bg-light-primary">
                              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle></svg>
                            </a>
                            <%if(session.contactus_permission == '3'){%>
                            <button onclick="confirmDelete('<%=data._id%>')" class="btn btn-sm bg-danger"> 
                              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                          </td>
                          <%}%>
                        </tr>
                        <%} )%>
                    </tbody>
                  </table>

                  <%}else{%>
                    <table class="table table-hover-animation">
                      <thead>
                        <tr>
                          <th>S NO.</th>
                          <th>Name</th>
                          <th>Email</th>
                          <th>Phone</th>
                          <th>Message</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        <%contactUsData.forEach(function(data,i) {%>
                          <tr>
                            <td>
                              <%=1+i%>
                            </td>
                            <td>
                              <%=data.name%>
                            </td>
                            <td>
                              <%=data.email%>
                            </td>
                            <td>
                              <%=data.phone%>
                            </td>
                            <td>
                              <%=data.message%>
                            </td>
                            <td>
                              <a href="/viewContactUs/<%=data._id%>" class="btn btn-sm bg-light-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye">
                                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                  <circle cx="12" cy="12" r="3"></circle></svg>
                              </a>
                              <button onclick="confirmDelete('<%=data._id%>')" class="btn btn-sm bg-danger"> 
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                              </button>
                            </td>
                          </tr>
                          <%} )%>
                      </tbody>
                    </table>
                    <%} %>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>

    <div class="sidenav-overlay"></div>
    <div class="drag-target"></div>


    <%- include('../common/footer') %>

      <script>
        $(document).ready(function () {
          $('.table').DataTable(); // Initialize DataTable for all tables with the 'table' class
        });
      </script>

      <script>
        $(document).ready(function () {
          // alert("ready!");
        });

        function confirmDelete(id) {
          console.log(">>>>>>>>done>>>>>>>>>>", id)

          const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
              confirmButton: 'btn btn-danger',
              cancelButton: 'btn btn-success'
            },
            buttonsStyling: true

          })

          // console.log("------------------------------result------", id);

          swalWithBootstrapButtons.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, delete it!',
            cancelButtonText: 'No, cancel!',
            reverseButtons: true
          }).then((isConfirm) => {
            // console.log(isConfirm)
            // return
            if (isConfirm.isConfirmed) {
              // alert('asd')
              $.ajax({
                url: "/delete_contact/:id",
                type: 'delete',
                data: {
                  id: id
                },
                success: function (result) { }
              });
              swalWithBootstrapButtons.fire(
                'Deleted!',
                'The user has been deleted .',
                'success'
              ).then(() => {
                location.reload();
              })
            } else {
              swalWithBootstrapButtons.fire(
                'Cancelled',
                'The user is safe :)',
                'error'
              )
            }
          })

        }
      </script>

      <script>
        const changeStatus = (val) => {
          console.log(val)
          let id = val.getAttribute('data-id')
          let value = val.getAttribute('value')
          let elemID = val.getAttribute('id')
          elemID = document.getElementById(elemID)

          $.ajax({
            type: "post",
            url: "/userStatus",
            data: {
              id: id,
              value: value

            },
            success: function (data) {
              if (data) {
                elemID.setAttribute('value', 0)
                elemID.innerText = `Active`
                elemID.classList.remove('btn-danger')
                elemID.classList.add('btn-success')
              } else {
                elemID.setAttribute('value', 1)
                elemID.innerText = `IN-Active`
                elemID.classList.remove('btn-success')
                elemID.classList.add('btn-danger')
              }
              window.location.reload();
            }
          });
        }

      </script>