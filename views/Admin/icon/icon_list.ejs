<%- include('../common/header') %>
<%- include('../common/sidebar') %>

  <div class="app-content content ">
    <div class="content-overlay"></div>
    <div class="header-navbar-shadow"></div>
    <div class="content-wrapper container-xxl p-0">
      <div class="content-body">
        <section id="responsive-datatable">
          <div class="row">
            <div class="card">
              <div class="card-header border-bottom">
                <h4 class="card-title">Icon List</h4>
                <div class="section-header-breadcrumb-right">
                  <a href="/add_icon" class="btn btn-primary float-right" title="Edit Profile"> Add Icon </a>
                </div>
              </div>
                <br>
              <div class="card-DataTable table-responsive">
                <table class="table table-hover-animation" style="color: rgb(65, 64, 64);" >
                  <thead>
                    <tr>
                      <th>S NO.</th>
                      <th>Image</th>
                      <th>Background color</th>
                      <th>Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <%iconList.forEach(function(data,i) {%>
                      <tr>
                        <td> <%=1+i%> </td>
                        <td> <img src="<%=data.image%>" width="45px" height="40px" type="submit" style="cursor:pointer;"> </td>
                        <td> <input type="color" id="head" name="head" style="width: 100px;" value="<%=data.bg_color%>" disabled /> </td>
                        <td>
                          <% if(data.status==1) { %>
                            <button onclick="changeStatus(this)" id="userId_<%-data.id%>" class=" btn btn-sm btn-success status " data-id="<%=data._id%>"
                              value="0">Active
                            </button>
                            <% } else { %>
                              <button onclick="changeStatus(this)" id="userId_<%-data.id%>" class="btn btn-sm btn-danger status" data-id="<%=data._id%>" value="1"
                                style="display: flex;">In-active </button>
                          <% } %>
                        </td>
                        <td>
                          <!-- <a href="/activity_view/<%=data._id%>" class="btn btn-sm bg-light-primary"><i data-feather='eye'></i></a> -->
                          <a href="/edit_icon/<%=data._id%>" class="btn btn-sm bg-warning">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                          </a>
                          <button onclick="confirmDelete('<%=data._id%>')" class="btn btn-sm bg-danger"> 
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash">
                              <polyline points="3 6 5 6 21 6"></polyline>
                              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                          </button>
                        </td>
                      </tr>
                      <%} )%>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <div class="sidenav-overlay"></div>
  <div class="drag-target"></div>

    <%- include('../common/footer') %>

    <script>
      setTimeout(function () {
        $("div.msg").fadeOut();
      }, 2000);
    </script>

    <script>
      $(document).ready(function () {
        $('.table').DataTable(); // Initialize DataTable for all tables with the 'table' class
      });
    </script>

    <script>
      $(document).ready(function () {
        // alert("ready!");
      });

      function confirmDelete(id) {
        console.log(">>>>>>>>done>>>>>>>>>>", id)

        const swalWithBootstrapButtons = Swal.mixin({
          customClass: {
            confirmButton: 'btn btn-danger',
            cancelButton: 'btn btn-success'
          },
          buttonsStyling: true
        })

        swalWithBootstrapButtons.fire({
          title: 'Are you sure?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, delete it!',
          cancelButtonText: 'No, cancel!',
          reverseButtons: true
        }).then((isConfirm) => {
          // console.log(isConfirm)
          // return
          if (isConfirm.isConfirmed) {
            // alert('asd')
            $.ajax({
              url: "/delete_icon/:id",
              type: 'delete',
              data: {
                id: id
              },
              success: function (result) { }
            });
            swalWithBootstrapButtons.fire(
              'Deleted!',
              'The Icon has been deleted .',
              'success'
            ).then(() => {
              location.reload();
            })
          } else {
            swalWithBootstrapButtons.fire(
              'Cancelled',
              'The Icon is safe :)',
              'error'
            )
          }
        })

      }
    </script>

    <script>
      const changeStatus = (val) => {
        console.log(val)
        let id = val.getAttribute('data-id')
        let value = val.getAttribute('value')
        let elemID = val.getAttribute('id')
        elemID = document.getElementById(elemID)

        $.ajax({
          type: "post",
          url: "/activityStatus",
          data: {
            id: id,
            value: value
          },
          success: function (data) {
            if (data) {
              elemID.setAttribute('value', 0)
              elemID.innerText = `Active`
              elemID.classList.remove('btn-danger')
              elemID.classList.add('btn-success')
            } else {
              elemID.setAttribute('value', 1)
              elemID.innerText = `IN-Active`
              elemID.classList.remove('btn-success')
              elemID.classList.add('btn-danger')
            }
            window.location.reload();
          }
        });
      }

    </script>